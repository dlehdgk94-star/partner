<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>í˜¸í…” ì¸ìŠ¤íƒ€ íŒŒíŠ¸ë„ˆì„¼í„°</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
    
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; padding: 20px; background-color: #f4f5f7; }
        
        /* ë‹¬ë ¥ ë””ìì¸ ì»¤ìŠ¤í…€ */
        #calendar {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            max-width: 1200px;
            margin: 0 auto;
        }

        /* ìº˜ë¦°ë” ì•ˆì˜ ë°© ì •ë³´ ë¸”ë¡ ë””ìì¸ (ì•¼ë†€ì ìŠ¤íƒ€ì¼) */
        .fc-event {
            cursor: pointer;
            border: none !important;
            margin-bottom: 2px !important;
            padding: 4px;
            border-radius: 4px;
        }
        .room-block {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
        }
        .room-name { font-weight: bold; }
        .room-price { font-weight: bold; }
        
        /* ì˜ˆì•½ ë§ˆê°ì´ë©´ íšŒìƒ‰, ê°€ëŠ¥í•˜ë©´ ì´ˆë¡ìƒ‰, íŠ¹ê°€ëŠ” ë¹¨ê°„ìƒ‰ */
        .status-available { background-color: #e8f5e9; color: #2e7d32; border-left: 3px solid #2e7d32; }
        .status-full { background-color: #ffebee; color: #c62828; border-left: 3px solid #c62828; text-decoration: line-through; }
        .status-custom { background-color: #fff3e0; color: #ef6c00; border-left: 3px solid #ef6c00; } /* íŠ¹ê°€ */

    </style>
</head>
<body>

    <h1 style="text-align: center; color: #333;">ğŸ“… í˜¸í…” ì¸ìŠ¤íƒ€ íŒë§¤ ìº˜ë¦°ë”</h1>
    
    <div id='calendar'></div>

    <script>
        // ==========================================
        // 1. Supabase ì—°ê²° (ë„¤ í‚¤ë¡œ ë°”ê¿”ì¤˜!)
        // ==========================================
        const supabaseUrl = 'ì—¬ê¸°ì—_URL_ë¶™ì—¬ë„£ê¸°'
        const supabaseKey = 'ì—¬ê¸°ì—_ANON_KEY_ë¶™ì—¬ë„£ê¸°'
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey)

        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');

            // 2. ë‹¬ë ¥ ê¸°ë³¸ ì„¤ì • (FullCalendar)
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth', // ì›”ë³„ ë³´ê¸°
                locale: 'ko',               // í•œêµ­ì–´ ì„¤ì •
                height: 'auto',             // ë†’ì´ ìë™
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,listWeek'
                },
                
                // 3. ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (Supabase -> ë‹¬ë ¥)
                events: async function(info, successCallback, failureCallback) {
                    
                    // Supabaseì—ì„œ inventoryì™€ rooms ì •ë³´ë¥¼ í•©ì³ì„œ ê°€ì ¸ì˜´
                    // (ë‚ ì§œ ë²”ìœ„ì— ë§ëŠ” ë°ì´í„°ë§Œ ê°€ì ¸ì˜¤ê²Œ ì„¤ì •)
                    const { data, error } = await supabase
                        .from('inventory')
                        .select(`
                            date, price, stock, is_available, is_custom,
                            rooms ( name )
                        `)
                        .gte('date', info.startStr.split('T')[0]) // ë‹¬ë ¥ì— ë³´ì´ëŠ” ì‹œì‘ ë‚ ì§œë¶€í„°
                        .lte('date', info.endStr.split('T')[0]);  // ë‹¬ë ¥ì— ë³´ì´ëŠ” ë ë‚ ì§œê¹Œì§€

                    if (error) {
                        console.error('ì—ëŸ¬:', error);
                        failureCallback(error);
                        return;
                    }

                    // ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼ ë‹¬ë ¥ í˜•ì‹(Event)ìœ¼ë¡œ ë³€í™˜
                    const events = data.map(item => {
                        let colorClass = 'status-available';
                        if (!item.is_available || item.stock <= 0) colorClass = 'status-full';
                        else if (item.is_custom) colorClass = 'status-custom'; // íŠ¹ê°€ëŠ” ì£¼í™©ìƒ‰

                        return {
                            title: item.rooms.name, // ë°© ì´ë¦„
                            start: item.date,       // ë‚ ì§œ
                            extendedProps: {        // ì¶”ê°€ ì •ë³´ (ê°€ê²© ë“±)
                                price: item.price,
                                stock: item.stock
                            },
                            classNames: [colorClass] // ìƒ‰ìƒ ì…íˆê¸°
                        }
                    });

                    successCallback(events);
                },

                // 4. ë‹¬ë ¥ì— ê·¸ë ¤ì§€ëŠ” ëª¨ì–‘ ê¾¸ë¯¸ê¸° (ë°© ì´ë¦„ + ê°€ê²©)
                eventContent: function(arg) {
                    let price = arg.event.extendedProps.price.toLocaleString();
                    let stock = arg.event.extendedProps.stock;
                    let name = arg.event.title;
                    
                    // HTMLë¡œ ì˜ˆì˜ê²Œ ë§Œë“¤ê¸°
                    let html = `
                        <div class="room-block">
                            <span class="room-name">${name}</span>
                            <span class="room-price">${price}ì›</span>
                        </div>
                        <div style="font-size:10px; text-align:right;">ë‚¨ì€ë°©: ${stock}</div>
                    `;
                    return { html: html }
                }
            });

            // ë‹¬ë ¥ ê·¸ë¦¬ê¸° ì‹œì‘!
            calendar.render();
        });
    </script>

</body>
</html>
