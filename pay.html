<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì—°ê²° í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
    <style>
        body { padding: 50px; font-family: sans-serif; }
        #status { padding: 20px; background: #eee; margin-bottom: 20px; border-radius: 8px; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
    </style>
</head>
<body>

    <h2>ğŸ“¢ ìŠˆíŒŒë² ì´ìŠ¤ ì—°ê²° ì§„ë‹¨ ëª¨ë“œ</h2>
    <div id="status">ì—°ê²° í™•ì¸ ì¤‘...</div>
    <div id='calendar'></div>

    <script>
        // 1. ìŠˆíŒŒë² ì´ìŠ¤ ì„¤ì •
        const supabaseUrl = 'https://eyasihczaqsacenklhns.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV5YXNpaGN6YXFzYWNlbmtsaG5zIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQzNjY5MTIsImV4cCI6MjA3OTk0MjkxMn0.E1J5qEgl79Ato3upXJSL0OyrgsOw6gJbNHo88AWdct0'
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey)

        // 2. ì§„ë‹¨ ì‹œì‘
        async function runDiagnosis() {
            const statusDiv = document.getElementById('status');
            
            // í…ŒìŠ¤íŠ¸ 1: ê·¸ëƒ¥ inventory ë°ì´í„° ì•„ë¬´ê±°ë‚˜ 1ê°œë§Œ ê°€ì ¸ì™€ë³´ê¸° (ë°© ì´ë¦„ ì—°ê²° ì—†ì´)
            const { data, error } = await supabase
                .from('inventory')
                .select('*') // ë³µì¡í•œ ì—°ê²° ë¹¼ê³  ì „ì²´ ê°€ì ¸ì˜¤ê¸°
                .limit(5);

            if (error) {
                console.error("ì—ëŸ¬ ë°œìƒ:", error);
                statusDiv.innerHTML = `<span class="error">âŒ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨!</span><br>ì—ëŸ¬ ë‚´ìš©: ${error.message}<br><br>ğŸ‘‰ F12ë¥¼ ëˆŒëŸ¬ ì½˜ì†”ì°½ì„ ìº¡ì²˜í•´ì„œ ë³´ì—¬ì£¼ì„¸ìš”.`;
                return;
            }

            if (!data || data.length === 0) {
                statusDiv.innerHTML = `<span class="error">âš ï¸ ì—°ê²°ì€ ëëŠ”ë° ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤!</span><br>inventory í…Œì´ë¸”ì— ë°ì´í„°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.`;
                return;
            }

            // ì„±ê³µ ì‹œ
            statusDiv.innerHTML = `<span class="success">âœ… ì—°ê²° ì„±ê³µ! ë°ì´í„° ${data.length}ê°œë¥¼ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.</span><br>ì´ì œ ë‹¬ë ¥ì„ ê·¸ë¦½ë‹ˆë‹¤.`;
            console.log("ê°€ì ¸ì˜¨ ë°ì´í„°:", data);

            // ë‹¬ë ¥ ê·¸ë¦¬ê¸°
            var calendarEl = document.getElementById('calendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'ko',
                events: data.map(item => ({
                    title: `ë°©ID:${item.room_id} / ${Number(item.price).toLocaleString()}ì›`,
                    start: item.date,
                    color: item.is_available ? '#3788d8' : '#999'
                }))
            });
            calendar.render();
        }

        runDiagnosis();
    </script>
</body>
</html>
