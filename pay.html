<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ìŠˆíŒŒë² ì´ìŠ¤ ì‹¬ì¸µ ì§„ë‹¨</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
    <style>
        body { padding: 50px; font-family: sans-serif; }
        #status { padding: 20px; background: #f0f0f0; margin-bottom: 20px; border-radius: 8px; border: 1px solid #ccc; }
        .success { color: green; font-weight: bold; font-size: 1.2em; }
        .error { color: red; font-weight: bold; font-size: 1.2em; background: #ffe6e6; padding: 10px; display: block; }
        .info { color: blue; }
    </style>
</head>
<body>

    <h2>ğŸš‘ ìŠˆíŒŒë² ì´ìŠ¤ ì—°ê²° ì‹¬ì¸µ ì§„ë‹¨</h2>
    <div id="status">ğŸ” ì§„ë‹¨ì„ ì‹œì‘í•©ë‹ˆë‹¤...</div>
    <div id='calendar'></div>

    <script>
        // 1. ì „ì—­ ì—ëŸ¬ ìºì¹˜ (ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ì‹¤íŒ¨ ë“± ì¡ê¸° ìœ„í•¨)
        window.onerror = function(message, source, lineno, colno, error) {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<span class="error">ğŸ’¥ ì¹˜ëª…ì  ì˜¤ë¥˜ ë°œìƒ!</span><br>
            ë‚´ìš©: ${message}<br>
            ìœ„ì¹˜: ${lineno}ë²ˆì§¸ ì¤„<br>
            <br>ğŸ‘‰ ì´ í™”ë©´ì„ ìº¡ì²˜í•´ì„œ ë³´ì—¬ì£¼ì„¸ìš”!`;
            return true;
        };

        // 2. ì§„ë‹¨ ë¡œì§
        async function runDiagnosis() {
            const statusDiv = document.getElementById('status');
            
            try {
                // ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ í™•ì¸
                if (!window.supabase) {
                    throw new Error("ìŠˆíŒŒë² ì´ìŠ¤ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. (ì¸í„°ë„· ì—°ê²° í™•ì¸ í•„ìš”)");
                }

                statusDiv.innerHTML = "<span class='info'>ğŸ”„ ìŠˆíŒŒë² ì´ìŠ¤ ì ‘ì† ì‹œë„ ì¤‘...</span>";

                // ì„¤ì •
                const supabaseUrl = 'https://eyasihczaqsacenklhns.supabase.co';
                const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV5YXNpaGN6YXFzYWNlbmtsaG5zIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQzNjY5MTIsImV4cCI6MjA3OTk0MjkxMn0.E1J5qEgl79Ato3upXJSL0OyrgsOw6gJbNHo88AWdct0';
                const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

                // ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹œë„
                const { data, error } = await supabase
                    .from('inventory')
                    .select('*')
                    .limit(5);

                if (error) {
                    throw error; // ì—ëŸ¬ê°€ ìˆìœ¼ë©´ catch ë¸”ë¡ìœ¼ë¡œ ë³´ëƒ„
                }

                if (!data || data.length === 0) {
                    statusDiv.innerHTML = `<span class="error">âš ï¸ ì—°ê²° ì„±ê³µí–ˆìœ¼ë‚˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤!</span><br>inventory í…Œì´ë¸”ì´ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.`;
                } else {
                    statusDiv.innerHTML = `<span class="success">âœ… ì—°ê²° í…ŒìŠ¤íŠ¸ ì„±ê³µ!</span><br>ë°ì´í„° ${data.length}ê°œë¥¼ ë¬´ì‚¬íˆ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.<br>ì²« ë²ˆì§¸ ë°ì´í„° ë‚ ì§œ: ${data[0].date}`;
                    
                    // ë‹¬ë ¥ ê·¸ë¦¬ê¸° í…ŒìŠ¤íŠ¸
                    var calendarEl = document.getElementById('calendar');
                    var calendar = new FullCalendar.Calendar(calendarEl, {
                        initialView: 'dayGridMonth',
                        locale: 'ko',
                        events: data.map(item => ({
                            title: `ì¬ê³ :${item.stock}`,
                            start: item.date
                        }))
                    });
                    calendar.render();
                }

            } catch (err) {
                console.error(err);
                statusDiv.innerHTML = `<span class="error">âŒ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤!</span><br>
                ì—ëŸ¬ ë‚´ìš©: <strong>${err.message}</strong><br>
                <br>ğŸ‘‰ ì´ ë¹¨ê°„ ê¸€ì”¨ë¥¼ ì €ì—ê²Œ ì•Œë ¤ì£¼ì„¸ìš”!`;
            }
        }

        // ì§„ë‹¨ ì‹¤í–‰
        runDiagnosis();
    </script>
</body>
</html>
